<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Pygoda Leaflet Map</title>
        <!-- Leaflet components -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
              integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
              crossorigin=""/>
        <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
                integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
                crossorigin=""></script>
        <!-- uPlot components -->
        <link rel="stylesheet" href="uPlot.min.css">
        <script src="uPlot.iife.min.js"></script>
        <style>
         body { padding: 0; margin: 0; }
         html, body, #map { height: 100%; }
        </style>
    </head>
    <body>
        <div id="map"></div>
    </body>
    <script>
     var createPlot = function(plot_id) {
        let temps = [
        [14.2,14,13.9,13.8,13.7,13.5,13.4,13.3,13.2,13.1,13.1,13,12.9,12.8,12.8,12.7,12.7,12.7,12.6,12.6,12.6,12.7,12.7,12.7,12.8,12.8,12.9,13,13.1,13.2,13.3,13.5,13.7,13.8,14,14.2,14.4,14.7,14.9,15.1,15.4,15.7,15.9,16.2,16.5,16.8,17.1,17.5,17.8,18.1,18.4,18.8,19.1,19.4,19.8,20.1,20.4,20.8,21.1,21.4,21.7,22.1,22.4,22.7,23,23.4,23.7,24,24.3,24.6,24.9,25.2,25.5,25.9,26.2,26.5,26.8,27.1,27.4,27.7,28.1,28.4,28.7,29,29.4,29.7,30.1,30.4,30.8,31.1,31.5,31.9,32.2,32.6,33,33.4,33.8,34.2,34.5,34.9,35.3,35.7,36.1,36.5,36.9,37.3,37.7,38,38.4,38.8,39.2,39.5,39.9,40.2,40.6,40.9,41.2,41.6,41.9,42.2,42.5,42.8,43.1,43.4,43.7,44,44.3,44.6,44.9,45.1,45.4,45.7,46,46.3,46.5,46.8,47.1,47.4,47.7,48.1,48.4,48.7,49,49.4,49.7,50.1,50.5,50.8,51.2,51.6,52,52.4,52.8,53.2,53.7,54.1,54.5,54.9,55.4,55.8,56.2,56.6,57.1,57.5,57.9,58.3,58.7,59,59.4,59.8,60.1,60.4,60.7,61,61.3,61.5,61.8,62,62.2,62.4,62.5,62.7,62.8,62.9,63,63,63.1,63.1,63.1,63.1,63.1,63.1,63,63,62.9,62.9,62.8,62.7,62.7,62.6,62.5,62.4,62.3,62.3,62.2,62.1,62,62,61.9,61.9,61.8,61.8,61.7,61.7,61.7,61.6,61.6,61.6,61.6,61.6,61.6,61.6,61.6,61.6,61.5,61.5,61.5,61.5,61.4,61.4,61.3,61.2,61.1,61,60.9,60.7,60.6,60.4,60.2,60,59.8,59.5,59.2,58.9,58.6,58.3,57.9,57.6,57.2,56.8,56.4,55.9,55.5,55,54.5,54.1,53.6,53.1,52.6,52.1,51.6,51.1,50.6,50.1,49.6,49.1,48.6,48.2,47.7,47.2,46.8,46.4,46,45.6,45.2,44.8,44.4,44.1,43.7,43.4,43.1,42.8,42.5,42.2,42,41.7,41.5,41.2,41,40.7,40.5,40.3,40,39.8,39.6,39.3,39.1,38.8,38.5,38.3,38,37.7,37.4,37,36.7,36.4,36,35.6,35.2,34.8,34.4,34,33.5,33.1,32.6,32.1,31.7,31.2,30.7,30.2,29.6,29.1,28.6,28.1,27.5,27,26.5,26,25.5,25,24.5,24,23.5,23,22.5,22.1,21.6,21.2,20.8,20.4,20,19.6,19.3,18.9,18.6,18.3,18,17.7,17.4,17.1,16.9,16.6,16.4,16.2,16,15.8,15.6,15.4,15.2,15,14.9,14.7,14.6,14.4,14.3],
        [29.4,29.3,29.2,29.1,29.1,29,28.9,28.9,28.8,28.7,28.7,28.6,28.6,28.6,28.5,28.5,28.5,28.5,28.5,28.5,28.5,28.5,28.6,28.6,28.7,28.7,28.8,28.9,29,29.2,29.3,29.4,29.6,29.8,30,30.2,30.4,30.7,30.9,31.2,31.5,31.8,32.1,32.4,32.7,33.1,33.4,33.8,34.1,34.5,34.9,35.3,35.7,36,36.4,36.8,37.2,37.6,38,38.4,38.9,39.3,39.7,40.1,40.5,40.8,41.2,41.6,42,42.4,42.8,43.2,43.6,43.9,44.3,44.7,45.1,45.5,45.8,46.2,46.6,47,47.4,47.8,48.1,48.5,48.9,49.3,49.7,50.1,50.6,51,51.4,51.8,52.3,52.7,53.1,53.6,54,54.5,54.9,55.4,55.8,56.3,56.7,57.2,57.6,58.1,58.5,59,59.4,59.8,60.3,60.7,61.1,61.5,61.9,62.3,62.7,63.1,63.5,63.8,64.2,64.5,64.9,65.2,65.5,65.9,66.2,66.5,66.8,67.1,67.4,67.7,68,68.3,68.6,68.8,69.1,69.4,69.7,70,70.3,70.6,70.9,71.2,71.5,71.8,72.1,72.4,72.7,73.1,73.4,73.7,74.1,74.4,74.7,75.1,75.4,75.8,76.1,76.5,76.8,77.2,77.5,77.8,78.2,78.5,78.8,79.1,79.4,79.7,80,80.3,80.5,80.8,81,81.2,81.4,81.6,81.8,81.9,82,82.2,82.3,82.4,82.4,82.5,82.5,82.5,82.6,82.6,82.5,82.5,82.5,82.4,82.4,82.3,82.3,82.2,82.1,82,82,81.9,81.8,81.7,81.6,81.5,81.5,81.4,81.3,81.3,81.2,81.1,81.1,81,81,80.9,80.9,80.8,80.8,80.8,80.7,80.7,80.6,80.6,80.6,80.5,80.5,80.4,80.3,80.3,80.2,80.1,80,79.9,79.7,79.6,79.4,79.2,79.1,78.8,78.6,78.4,78.1,77.9,77.6,77.3,76.9,76.6,76.2,75.9,75.5,75.1,74.7,74.3,73.8,73.4,72.9,72.5,72,71.6,71.1,70.6,70.2,69.7,69.2,68.8,68.3,67.8,67.4,66.9,66.5,66.1,65.6,65.2,64.8,64.4,64,63.6,63.2,62.9,62.5,62.1,61.8,61.4,61.1,60.7,60.4,60,59.7,59.4,59,58.7,58.3,57.9,57.6,57.2,56.8,56.4,56,55.6,55.2,54.7,54.3,53.8,53.4,52.9,52.4,51.9,51.4,50.8,50.3,49.7,49.2,48.6,48,47.4,46.8,46.2,45.6,45,44.4,43.8,43.2,42.6,42,41.4,40.9,40.3,39.7,39.2,38.6,38.1,37.6,37.1,36.6,36.1,35.7,35.3,34.9,34.5,34.1,33.7,33.4,33,32.7,32.4,32.2,31.9,31.7,31.4,31.2,31,30.8,30.7,30.5,30.3,30.2,30.1,29.9,29.8,29.7,29.6,29.5],
        ];

        let avgs = temps[0].map((low, i) => +((low + temps[1][i]) / 2).toFixed(2));

        temps.push(avgs);

        let d = Date.UTC(2010,0,1)/1000;
        let num = 365;
        let ts = [];

        for (let i = 0; i < 365; i++, d += 3600 * 24)
            ts.push(d);

        temps.unshift(ts);

        let data = temps;

        function fmtUSD(val, dec) {
            return "$" + val.toFixed(dec).replace(/\d(?=(\d{3})+(?:\.|$))/g, '$&,');
        }

        const opts = {
            width: 400,
            height: 200,
            title: "Temps",
            tzDate: ts => uPlot.tzDate(new Date(ts * 1e3), 'Etc/UTC'),
            series: [
                {},
                {
                    label: "Low",
                    stroke: "blue",
                    fill: "rgba(0, 0, 0, .07)",
                    value: (u, v) => v + "째F",
                    band: true,
                    width: 0,
                },
                {
                    label: "High",
                    stroke: "red",
                    fill: "rgba(0, 0, 0, .07)",
                    value: (u, v) => v + "째F",
                    band: true,
                    width: 0,
                },
                {
                    label: "Avg",
                    stroke: "teal",
                    dash: [10, 10],
                    width: 2,
                    value: (u, v) => v + "째F",
                },
            ],
            axes: [
                {},
                {
                    values: (u, vals) => vals.map(v => v + "째F")
                }
            ]
        };
         
        let plot = document.querySelector("#plot_" + plot_id);
        let u = new uPlot(opts, data, plot);
     };
    </script>
    <script>
        var map = L.map('map').setView([51.505, -0.09], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        function groupClick(event) {
            var sta_id = event.layer.sta_id;
            createPlot(sta_id);
            console.log("Clicked on marker " + sta_id);
        };
        var myFeatureGroup = L.featureGroup().addTo(map).on("click", groupClick);

        var addMarker = function(sta_id, coord, popupContent) {
            // var marker = L.marker(map.getCenter()).addTo(map);
            var marker = L.marker(coord).addTo(myFeatureGroup).addTo(map);
            marker.bindPopup(popupContent, {maxWidth: "auto"});
            marker.sta_id = sta_id;
            createPlot(sta_id);
            marker.openPopup();
        };
     addMarker('ABCD', [51.505, -0.09], `<div style='padding: 0; margin: 0; width: 400px; height: 250px;' id='plot_ABCD'></div>`);
    </script>
</html>

